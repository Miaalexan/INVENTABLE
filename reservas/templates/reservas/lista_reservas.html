{% extends 'base.html' %}
{% block title %}INVENTABLE{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-calendar-check-fill"></i> Gestión de Reservas</h2>
        </div>
    </div>

    <!--  Barra de acciones -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" action="{% url 'reservas:lista_reservas' %}">
                <div class="row g-3 align-items-center">

                    <!-- Botón Nueva Reserva -->
                    <div class="col-md-3 col-sm-6">
                        <a href="{% url 'reservas:crear_reserva' %}" class="btn btn-primary w-100">
                            <i class="bi bi-plus-circle-fill"></i> Nueva Reserva
                        </a>
                    </div>

                    <!-- Buscar cliente -->
                    <div class="col-md-3 col-sm-6">
                        <input 
                            type="text" 
                            name="buscar" 
                            class="form-control"
                            placeholder="Buscar cliente..." 
                            value="{{ buscar }}"
                        >
                    </div>

                    <!--  Filtro por fecha con ícono -->
                    <div class="col-md-3 col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text bg-light">
                                <i class="bi bi-calendar-event"></i>
                            </span>
                            <input 
                                type="date" 
                                name="fecha" 
                                class="form-control"
                                value="{{ filtro_fecha|default:'' }}"
                            >
                            <button type="submit" class="btn btn-outline-secondary">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Filtro por estado -->
                    <div class="col-md-3 col-sm-6">
                        <select name="estado" class="form-select" onchange="this.form.submit()">
                            <option value="todos" {% if estado_filtro == 'todos' %}selected{% endif %}>Todas</option>
                            <option value="pendiente" {% if estado_filtro == 'pendiente' %}selected{% endif %}>Pendiente</option>
                            <option value="confirmada" {% if estado_filtro == 'confirmada' %}selected{% endif %}>Confirmada</option>
                            <option value="completada" {% if estado_filtro == 'completada' %}selected{% endif %}>Completada</option>
                            <option value="cancelada" {% if estado_filtro == 'cancelada' %}selected{% endif %}>Cancelada</option>
                        </select>
                    </div>

                </div>
            </form>
        </div>
    </div>

    <!--  Lista de Reservas -->
    <div class="row">
        {% for reserva in reservas %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ reserva.cliente }}</h5>
                    <p class="card-text mb-1"><strong>Fecha:</strong> {{ reserva.fecha_reserva }}</p>
                    <p class="card-text mb-1"><strong>Hora:</strong> {{ reserva.hora_reserva }}</p>
                    <p class="card-text mb-1"><strong>Personas:</strong> {{ reserva.num_personas }}</p>

                    <p class="card-text">
                        <strong>Estado:</strong>
                        {% if reserva.estado == 'pendiente' %}
                            <span class="badge bg-warning text-dark">Pendiente</span>
                        {% elif reserva.estado == 'confirmada' %}
                            <span class="badge bg-info text-dark">Confirmada</span>
                        {% elif reserva.estado == 'completada' %}
                            <span class="badge bg-success">Completada</span>
                        {% else %}
                            <span class="badge bg-secondary">Cancelada</span>
                        {% endif %}
                    </p>
                </div>

                <div class="card-footer text-center">
                    <div class="btn-group" role="group">
                        <a href="{% url 'reservas:editar_reserva' reserva.id %}" 
                           class="btn btn-sm btn-warning" title="Editar">
                            <i class="bi bi-pencil-fill"></i>
                        </a>
                        <a href="{% url 'reservas:cambiar_estado_reserva' reserva.id %}" 
                           class="btn btn-sm btn-info" title="Cambiar estado">
                            <i class="bi bi-arrow-repeat"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center text-muted">No hay reservas registradas.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
